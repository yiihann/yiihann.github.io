{{ $images := .Page.Resources.ByType "image" }}
{{ $images = sort $images "Name" }}
{{ $manualCaptions := index site.Data "photos" "photos" }}
{{ if $images }}
<div class="grid grid-cols-2 md:grid-cols-3 gap-4 my-6 items-start">
  {{ range $images }}
    {{ $oriented := . | images.Filter images.AutoOrient }}
    {{ $thumb := $oriented.Fit "800x800" }}
    {{ $caption := index $manualCaptions .Name }}
    {{ if not $caption }}
      {{/* Auto-generate caption from filename: remove extension, then remove leading numbers and separators */}}
      {{ $nameWithoutExt := replaceRE `\.[^.]+$` "" .Name }}
      {{ $caption = $nameWithoutExt | replaceRE `^[0-9]+[.\- ]*` "" | strings.TrimSpace }}
    {{ end }}
    <div class="flex flex-col">
      <a href="{{ $oriented.RelPermalink }}" class="block rounded-lg focus:outline-none focus:ring-2 focus:ring-primary-500 p-0 m-0" target="_blank" rel="noopener">
        <img src="{{ $thumb.RelPermalink }}" alt="{{ .Name }}" width="{{ $thumb.Width }}" height="{{ $thumb.Height }}" class="w-full h-auto hover:opacity-90 transition block" loading="lazy" />
      </a>
      {{ if $caption }}
      <p class="mt-1 text-sm text-gray-600 dark:text-gray-400 text-center">{{ $caption }}</p>
      {{ end }}
    </div>
  {{ end }}
</div>
{{ end }}
